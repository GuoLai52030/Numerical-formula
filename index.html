<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>血月平铺模拟器</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --c: #00e5ff; --g: #ff9f43; --bg: #000; }
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; }
        
        /* 强制缩放容器：这是解决 Antigravity 截断的关键 */
        #container { 
            width: 400px; /* 我们设计的逻辑宽度 */
            transform-origin: top left;
            padding: 10px;
        }

        .row { display: flex; gap: 5px; margin-bottom: 8px; }
        .box { flex: 1; background: #1a1a1a; padding: 5px; border-radius: 4px; border-top: 2px solid var(--c); }
        .label { font-size: 10px; color: #888; transform: scale(0.9); }
        .val { font-size: 14px; font-weight: bold; font-family: monospace; color: var(--c); }
        
        .slider-group { background: #111; padding: 8px; border-radius: 4px; margin-bottom: 8px; }
        .s-row { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 2px; }
        input[type=range] { width: 100%; height: 4px; accent-color: var(--c); cursor: pointer; margin: 5px 0; }

        .chart-wrap { height: 180px; background: #080808; border-radius: 4px; position: relative; }
        .axis { position: absolute; font-size: 9px; color: #444; }
    </style>
</head>
<body>

<div id="container">
    <div class="slider-group">
        <div class="s-row">血月等级(L) <span id="lt" class="val">0</span></div>
        <input type="range" id="ls" min="0" max="300" value="0">
        
        <div class="s-row">增伤词缀(%) <span id="bt" class="val">0</span></div>
        <input type="range" id="bs" min="0" max="1000" value="0" step="10">
        
        <div class="s-row">暴击率(%) <span id="ct" class="val">0</span></div>
        <input type="range" id="cs" min="0" max="100" value="0">
    </div>

    <div class="row">
        <div class="box"><div class="label">10次总攻</div><div id="v1" class="val">0</div></div>
        <div class="box" style="border-color:var(--g)"><div class="label">10次总暴(附)</div><div id="v2" class="val">0</div></div>
    </div>
    <div class="box" style="width:100%; border-color:#fff; margin-bottom:8px;">
        <div class="label">单轮CD(3s) 叠加总伤害</div>
        <div id="vt" class="val" style="font-size:18px; color:var(--g)">0</div>
    </div>

    <div class="chart-wrap">
        <div class="axis" style="top:50%; left:-15px; transform:rotate(-90deg)">Log</div>
        <canvas id="chart"></canvas>
    </div>
</div>

<script>
    // 强制缩放脚本：自动检测宽度并缩小 UI
    function scaleUI() {
        const cont = document.getElementById('container');
        const winW = window.innerWidth;
        const scale = winW / 400; 
        cont.style.transform = `scale(${scale})`;
    }
    window.addEventListener('resize', scaleUI);
    scaleUI();

    const ls=$('ls'), bs=$('bs'), cs=$('cs'), chartCtx=$('chart').getContext('2d');
    function $(id){ return document.getElementById(id); }

    function getHP(L) {
        if (L <= 100) return 3703 + 24.57 * L;
        if (L <= 200) return 6160 + 262.68 * (L - 100);
        return 32428 + 383.48 * (L - 200);
    }

    const chart = new Chart(chartCtx, {
        type: 'line',
        data: {
            labels: Array.from({length: 31}, (_, i) => i * 10),
            datasets: [
                { data: [], borderColor: '#333', borderWidth: 1, pointRadius: 0 },
                { data: [], borderColor: '#00e5ff', borderWidth: 2, pointRadius: 0 }
            ]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            scales: { y: { type: 'logarithmic', display: false }, x: { ticks: { color: '#444', font: { size: 8 } } } },
            plugins: { legend: { display: false } }
        }
    });

    function update() {
        const L = parseInt(ls.value), B = parseInt(bs.value)/100, C = parseInt(cs.value)/100;
        
        // 核心公式：基于图表数据的拟合
        const atk = 42 + 80 * (1 + B);
        const crit = 2 * atk - 42;
        
        const atkSum = atk * 10;
        const critSum = crit * 10;
        const total = atkSum + (critSum * C); // 叠加逻辑

        $('lt').innerText = L; $('bt').innerText = (B*100).toFixed(0); $('ct').innerText = (C*100).toFixed(0);
        $('v1').innerText = Math.round(atkSum).toLocaleString();
        $('v2').innerText = Math.round(critSum).toLocaleString();
        $('vt').innerText = Math.round(total).toLocaleString();

        chart.data.datasets[0].data = Array.from({length: 31}, (_, i) => getHP(i * 10));
        chart.data.datasets[1].data = Array(31).fill(total);
        chart.update('none');
    }

    [ls, bs, cs].forEach(s => s.addEventListener('input', update));
    update();
</script>
</body>
</html>
